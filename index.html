<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <meta charset="UTF-8" />
        <meta
            http-equiv="last-modified"
            content="Sun, 12 Dic 2012 12:00:00 GMT"
        />
        <meta http-equiv="cache-control" content="Private" />
        <meta http-equiv="Expires" content="600" />
        <title>ControlDeOrgánicos</title>
        <link
            rel="icon"
            type="image/png"
            href="https://i.imgur.com/h2gZejB.png"
        />
        <style>
            table,
            th {
                border: 1px solid black;
                text-align: left;
            }
            th {
                border-top: 0px solid black;
                border-left: 0px solid black;
                border-right: 0px solid black;
                border-bottom: 1px solid black;
                /* align: left; */
                text-align: left;
                background-color: #4caf50;
                color: white;
            }
            tr:nth-child(odd) {
                background-color: #f2f2f2;
            }
            p {
                margin: 0;
                display: inline-block;
                font-size: 12px;
                padding: 5px;
                font-style: italic;
                color: grey;
            }
            table,
            th {
                text-align: left;
            }
            .Titulo,
            .Titulo_Anterior {
                color: rgba(190, 7, 245, 0.842);
                text-decoration: underline;
                font-weight: bold;
                padding-bottom: 3px;
                display: inline-block;
            }
            hr {
                margin-top: 4px;
                margin-bottom: 4px;
            }
            .Titulo:hover {
                color: rgba(190, 7, 221, 0.999);
            }
            #Loading {
                height: 480px;
            }
            #AllContent {
                display: none;
            }
            .Fechas {
                font-style: normal;
                margin-left: -6px;
                padding-top: 1px;
                color: black;
            }
        </style>
    </head>
    <body>
        <img src="Spinner.gif" id="Loading" />
        <div id="AllContent">
            <a href="https://www.talloverde.com/" target="_blank"
                ><div class="Titulo_Anterior">::: TalloVerde :::</div></a
            >
            <br />
            <p id="Fecha_1" class="Fechas">• --------------</p>
            <br />
            <p id="Fecha_2" class="Fechas">• --------------</p>
            <br />
            <p id="Fecha_3" class="Fechas">• --------------</p>
            <br />
            <p id="Fecha_4" class="Fechas">• --------------</p>
            <br />
            <p id="Fecha_5" class="Fechas">• --------------</p>
            <br />
            <p id="Fecha_6" class="Fechas">• --------------</p>
            <br />
            <a href="https://www.comosiempreorganico.com/" target="_blank"
                ><div class="Titulo">::: ComoSiempreOrganico :::</div></a
            >
            <p id="HoraActual"></p>
            <table id="Tabla"></table>
        </div>
    </body>
</html>

<script>
    // ### Obtención de Fechas ###
    /*
    fetch("https://cors-anywhere.herokuapp.com/" + 'https://api.talloverde.com/api/zones/48/availableSchedules', {
            "headers": {
                "accept-language": "es-US,es;q=0.9,en-US;q=0.8,en;q=0.7,es-419;q=0.6",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "no-cors",
                "sec-fetch-site": "cross-site",
            },
        })
        .then(blob => blob.json())
        .then(data => {
        let numero = 0;
        console.log(data[numero]);
        document.querySelector("#Fecha_1").innerText = "• " + data[numero].date + ": " + data[numero].start + " a " + data[numero].end;
        return data;})
        */
    fetch(
        "https://cors-anywhere.herokuapp.com/" +
            "https://api.talloverde.com/api/zones/48/availableSchedules",
        {
            headers: {
                accept: "application/json, text/plain, */*",
                "accept-language":
                    "es-US,es;q=0.9,en-US;q=0.8,en;q=0.7,es-419;q=0.6",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "no-cors",
                "sec-fetch-site": "cross-site",
            },
        }
    )
        .then((blob) => blob.json())
        .then((data) => {
            let numero = 0;
            console.log(data[numero]);
            document.querySelector("#Fecha_1").innerText =
                "• " +
                data[numero].date +
                ": " +
                data[numero].start +
                " a " +
                data[numero].end;
            return data;
        });
</script>

<script>
    function timeConverter(UNIX_timestamp) {
        var a = new Date(UNIX_timestamp * 1000);
        var months = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
        ];
        var year = a.getFullYear();
        var month = months[a.getMonth()];
        var date = a.getDate();
        var hour = a.getHours();
        var min = a.getMinutes();
        var sec = a.getSeconds();
        var time =
            date +
            " " +
            month +
            " " +
            year +
            " " +
            hour +
            ":" +
            min +
            ":" +
            sec;
        return time;
    }
    function lastModified(uri) {
        return new Promise((resolve, reject) => {
            $.ajax({ url: uri, type: "HEAD" })
                .done((d, s, xhr) => {
                    let date = Date.parse(
                        xhr.getResponseHeader("Last-Modified")
                    );
                    resolve(date);
                })
                .fail((xhr, s, err) => {
                    reject(s);
                });
        });
    }
    $(document).ready(function () {
        $("#Tabla").load("content.html");
        //////////////////////////////////////////
        /////////////////////////////////////////
        setTimeout(function () {
            var target = location.href + "content.html";
            lastModified(target)
                .then((date) => {
                    dateObj = new Date(date);
                    var Ahora = new Date();
                    var Dia = dateObj.getDate();
                    var Mes = dateObj.getMonth() + 1;
                    if (Mes == 13) Mes = 1;
                    var Minutos = dateObj.getMinutes();
                    if (Minutos < 10) Minutos = "0" + Minutos;
                    var Horas = dateObj.getHours();
                    var Anio = dateObj.getFullYear();
                    var FechaDelArchivo =
                        Horas +
                        ":" +
                        Minutos +
                        " - " +
                        Dia +
                        "/" +
                        Mes +
                        "/" +
                        Anio;
                    //console.log(FechaDelArchivo);
                    $("#HoraActual").prepend(
                        "(Última Actualización: " + FechaDelArchivo + ")"
                    );
                })
                .catch((err) => {
                    console.log(err);
                });
            //////////////////////////////////////////
            /////////////////////////////////////////
            $("#Tabla").prepend(
                "<tr><th align='center'>Disponibles</th><th align='left'>Producto</th>"
            );
            function isOdd(num) {
                return num % 2;
            }
            function PintarNumerosMalos() {
                for (var i = 0; i < 200; i++) {
                    if (isOdd(i) == 0) {
                        try {
                            var Valor = parseInt(
                                document.getElementsByTagName("td")[i].innerText
                            );
                        } catch (e) {
                            continue;
                        }
                        document.getElementsByTagName("td")[i].style.textAlign =
                            "center";
                        if (Valor <= 3) {
                            document.getElementsByTagName("td")[i].style.color =
                                "orange";
                            document.getElementsByTagName("td")[
                                i + 1
                            ].style.color = "orange";
                        }
                        if (Valor == 0) {
                            document.getElementsByTagName("td")[i].style.color =
                                "red";
                            document.getElementsByTagName("td")[
                                i + 1
                            ].style.color = "red";
                        }
                    }
                }
            }
            PintarNumerosMalos();
            $("#AllContent").css("display", "block");
            $("#Loading").css("display", "none");
            // ### Eliminación de filas completamente vacías ###
            for (var h = 0; h < 200; h++) {
                for (var i = 0; i < 200; i++) {
                    try {
                        var textoEnFila = document.getElementsByTagName("tr")[i]
                            .innerText;
                        if (
                            textoEnFila == "	" ||
                            textoEnFila == "	" ||
                            textoEnFila == "	"
                        )
                            document.getElementsByTagName("tr")[i].remove();
                    } catch (e) {
                        continue;
                    }
                }
            }
            // ### Eliminación de valores vacíos ###
            for (var i = 0; i < 200; i++) {
                try {
                    var textoEnFila = document.getElementsByTagName("tr")[i]
                        .innerText;
                    var textoEnFila = textoEnFila.charAt(0);
                    if (textoEnFila == "	" || textoEnFila == " ") {
                        document.getElementsByTagName("tr")[i].remove();
                    }
                } catch (e) {
                    continue;
                }
            }
        }, 550);
    });
    ////////////////////////////////////////////////////////
    /*
    setTimeout(function () {
        // ••• Eliminación de filas completamente vacías •••
        for (var h = 0; h < 200; h++) {
            for (var i = 0; i < 200; i++) {
                try {
                    var textoEnFila = document.getElementsByTagName("tr")[i]
                        .innerText;
                    if (
                        textoEnFila == "	" ||
                        textoEnFila == "	" ||
                        textoEnFila == "	"
                    )
                        document.getElementsByTagName("tr")[i].remove();
                } catch (e) {
                    continue;
                }
            }
        }
        // ••• Eliminación de valores vacíos •••
        for (var i = 0; i < 200; i++) {
            try {
                var textoEnFila = document.getElementsByTagName("tr")[i]
                    .innerText;
                var textoEnFila = textoEnFila.charAt(0);
                if (textoEnFila == "	" || textoEnFila == " ") {
                    document.getElementsByTagName("tr")[i].remove();
                }
            } catch (e) {
                continue;
            }
        }
        // ••• Pintar Numeros Malos •••
        PintarNumerosMalos();
    }, 1000);
    ////////////////////////////////////////////////////////
    // ### Recargar la Web automáticamente cada 5 minutos ###
    setInterval("location.reload(true);", 300000);
    //});
    */
</script>
